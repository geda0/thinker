<!DOCTYPE html>
<html>
<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<h2>Postings</h2>

<div id="postings">
  <!-- Postings will be inserted here by JavaScript -->
</div>

<h2>Post data</h2>

<form id="postForm" action="{{ url_for('index') }}" method="post">
  {{ form.hidden_tag() }}
  {{ form.data.label }} {{ form.data(size=32) }}
  {{ form.submit() }}
</form>

<script>
function copyToClipboard(text) {
  var tempInput = document.createElement("input");
  tempInput.style = "position: absolute; left: -1000px; top: -1000px";
  tempInput.value = text;
  document.body.appendChild(tempInput);
  tempInput.select();
  document.execCommand("copy");
  document.body.removeChild(tempInput);
}

// Update the postings every 5 seconds
setInterval(function() {
  fetch('/get_postings')
  .then(response => response.json())
  .then(data => {
    const postingsDiv = document.getElementById('postings');
    postingsDiv.innerHTML = '';
    data.forEach((posting, index) => {
      const pre = document.createElement('pre');
      pre.textContent = posting;
      if (index === data.length - 1) {
        pre.id = 'latest'; // Give the latest element an id
      }
      postingsDiv.appendChild(pre);

      const copyButton = document.createElement('button');
      copyButton.textContent = '= = =';
      copyButton.onclick = function() { copyToClipboard(posting); };
      
      // Check if it's the last element and add a class for styling
      if (index === data.length - 1) {
        copyButton.style.fontSize = '900%';
      }

      postingsDiv.appendChild(copyButton);

      const deleteForm = document.createElement('form');
      deleteForm.action = '/delete/' + index;
      deleteForm.method = 'POST';
      deleteForm.style.display = 'inline';
      const deleteButton = document.createElement('input');
      deleteButton.type = 'submit';
      deleteButton.value = '" - "';
      deleteForm.appendChild(deleteButton);
      postingsDiv.appendChild(deleteForm);

      postingsDiv.appendChild(document.createElement('br'));
    });

    // Scroll to latest element
    document.getElementById('latest').scrollIntoView();
  });
}, 999);
</script>

</body>
</html>
